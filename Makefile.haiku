# Makefile.haiku - Native Haiku OS compilation only
# VeniceDAW Professional Spatial Audio Workstation

CXX = g++
CXXFLAGS = -std=c++11 -Wall -O2 -DHAIKU_NATIVE
INCLUDES = -I. -Isrc -I/boot/system/develop/headers -I/boot/system/develop/headers/os
LIBS = -lbe -lmedia -ltracker -lroot -lGL -lGLU -ltranslation

# Source directories
AUDIO_SRC = src/audio
GUI_SRC = src/gui
TEST_SRC = src/testing

# Output directory
BUILD_DIR = build

# Core audio sources
AUDIO_SOURCES = $(AUDIO_SRC)/SimpleHaikuEngine.cpp \
                $(AUDIO_SRC)/AdvancedAudioProcessor.cpp \
                $(AUDIO_SRC)/DSPAlgorithms.cpp

# GUI sources  
GUI_SOURCES = $(GUI_SRC)/Mixer3DWindow.cpp \
              $(GUI_SRC)/SpatialMixer3DWindow.cpp \
              $(GUI_SRC)/SpatialControlPanels.cpp \
              $(GUI_SRC)/TransportWindow.cpp

# Test sources
TEST_SOURCES = $(TEST_SRC)/SpatialAudioTest.cpp

# Object files
AUDIO_OBJECTS = $(AUDIO_SOURCES:.cpp=.o)
GUI_OBJECTS = $(GUI_SOURCES:.cpp=.o)
TEST_OBJECTS = $(TEST_SOURCES:.cpp=.o)

# Main targets
.PHONY: all clean install test-spatial test-hrtf test-audio test-3d test-files test-transport test-all help

all: VeniceDAW

help:
	@echo "VeniceDAW Native Haiku Build System"
	@echo "===================================="
	@echo ""
	@echo "üöÄ Build Targets:"
	@echo "  make -f Makefile.haiku               # Build complete VeniceDAW application"
	@echo "  make -f Makefile.haiku install       # Install to Desktop"
	@echo "  make -f Makefile.haiku clean         # Clean build files"
	@echo ""
	@echo "üß™ Test Targets:"
	@echo "  make -f Makefile.haiku test-all      # Run all tests"
	@echo "  make -f Makefile.haiku test-spatial  # Test spatial audio processing"
	@echo "  make -f Makefile.haiku test-hrtf     # Test HRTF binaural rendering"
	@echo "  make -f Makefile.haiku test-audio    # Test audio file playback"
	@echo "  make -f Makefile.haiku test-3d       # Test 3D mixer visualization"
	@echo "  make -f Makefile.haiku test-files    # Test file loading system"
	@echo "  make -f Makefile.haiku test-transport # Test transport GUI controls"
	@echo ""
	@echo "üìö Documentation:"
	@echo "  See CLAUDE.md for detailed build instructions"
	@echo "  See README.md for project overview"
	@echo

# Main application - Complete VeniceDAW with all features
VeniceDAW: src/main_spatial_gui.o $(AUDIO_OBJECTS) $(GUI_OBJECTS)
	@mkdir -p $(BUILD_DIR)
	@echo "üöÄ Building VeniceDAW for Haiku OS..."
	@echo "   Linking complete application with 3D mixer, spatial audio, and HRTF..."
	$(CXX) $(CXXFLAGS) src/main_spatial_gui.o $(AUDIO_OBJECTS) $(GUI_OBJECTS) -o $(BUILD_DIR)/VeniceDAW $(LIBS)
	@echo "‚úÖ VeniceDAW built successfully!"
	@echo "   Run with: ./$(BUILD_DIR)/VeniceDAW"

# Test targets
test-all: test-spatial test-hrtf test-audio test-3d
	@echo "üéâ All VeniceDAW tests completed!"

test-spatial: $(BUILD_DIR)/SpatialAudioTest
	@echo "üéØ Running Spatial Audio Tests (Phase 3.4 + 4.2)..."
	@$(BUILD_DIR)/SpatialAudioTest

test-hrtf: $(BUILD_DIR)/test_phase4_2_hrtf  
	@echo "üéß Running HRTF & Binaural Tests (Phase 4.2)..."
	@$(BUILD_DIR)/test_phase4_2_hrtf

test-audio: $(BUILD_DIR)/test_audio_playback
	@echo "üéµ Running Audio Playback Tests (Phase 5.3/5.4)..."
	@$(BUILD_DIR)/test_audio_playback

test-3d: $(BUILD_DIR)/test_3d_mixer
	@echo "üëÅÔ∏è Running 3D Mixer Tests..."
	@$(BUILD_DIR)/test_3d_mixer

test-files: $(BUILD_DIR)/test_file_loading
	@echo "üìÅ Running File Loading Tests..."
	@$(BUILD_DIR)/test_file_loading

test-transport: $(BUILD_DIR)/test_transport_gui
	@echo "üéõÔ∏è Running Transport GUI Test..."
	@$(BUILD_DIR)/test_transport_gui

# Build test executables
$(BUILD_DIR)/SpatialAudioTest: $(TEST_SRC)/SpatialAudioTest.cpp $(AUDIO_OBJECTS)
	@mkdir -p $(BUILD_DIR)
	@echo "üîß Building Spatial Audio Test..."
	$(CXX) $(CXXFLAGS) $(INCLUDES) $< $(AUDIO_OBJECTS) -o $@ $(LIBS)

$(BUILD_DIR)/test_phase4_2_hrtf: tests/test_phase4_2_hrtf.cpp $(AUDIO_OBJECTS)
	@mkdir -p $(BUILD_DIR)
	@echo "üîß Building Phase 4.2 HRTF Test..."
	$(CXX) $(CXXFLAGS) $(INCLUDES) $< $(AUDIO_OBJECTS) -o $@ $(LIBS)

$(BUILD_DIR)/test_audio_playback: tests/test_audio_playback.cpp $(AUDIO_OBJECTS)
	@mkdir -p $(BUILD_DIR)
	@echo "üîß Building Audio Playback Test..."
	$(CXX) $(CXXFLAGS) $(INCLUDES) $< $(AUDIO_OBJECTS) -o $@ $(LIBS)

$(BUILD_DIR)/test_3d_mixer: tests/test_3d_mixer.cpp
	@mkdir -p $(BUILD_DIR)
	@echo "üîß Building 3D Mixer Test..."
	$(CXX) $(CXXFLAGS) $(INCLUDES) $< -o $@ $(LIBS)

$(BUILD_DIR)/test_file_loading: tests/test_file_loading.cpp $(AUDIO_OBJECTS)
	@mkdir -p $(BUILD_DIR)
	@echo "üîß Building File Loading Test..."
	$(CXX) $(CXXFLAGS) $(INCLUDES) $< $(AUDIO_OBJECTS) -o $@ $(LIBS)

$(BUILD_DIR)/test_transport_gui: tests/test_transport_gui.cpp $(AUDIO_OBJECTS) $(GUI_OBJECTS)
	@mkdir -p $(BUILD_DIR)
	@echo "üîß Building Transport GUI Test..."
	$(CXX) $(CXXFLAGS) $(INCLUDES) $< $(AUDIO_OBJECTS) $(GUI_OBJECTS) -o $@ $(LIBS)

# Object file compilation
%.o: %.cpp
	@echo "üì¶ Compiling $<..."
	$(CXX) $(CXXFLAGS) $(INCLUDES) -c $< -o $@

# Clean
clean:
	@echo "üßπ Cleaning build files..."
	rm -rf $(BUILD_DIR)
	rm -f $(AUDIO_OBJECTS) $(GUI_OBJECTS) $(TEST_OBJECTS)
	rm -f src/main_spatial_gui.o
	@echo "‚úÖ Clean complete"

# Install to Desktop
install: VeniceDAW
	@echo "üì¶ Installing VeniceDAW to Desktop..."
	cp $(BUILD_DIR)/VeniceDAW ~/Desktop/
	@echo "‚úÖ VeniceDAW installed to ~/Desktop/"

# Create build directory
$(BUILD_DIR):
	@mkdir -p $(BUILD_DIR)